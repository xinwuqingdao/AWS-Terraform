import { Injectable } from '@angular/core';
import { concatMap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./callback-handling/code-flow-callback-handler.service";
import * as i2 from "./callback-handling/implicit-flow-callback-handler.service";
import * as i3 from "./callback-handling/history-jwt-keys-callback-handler.service";
import * as i4 from "./callback-handling/user-callback-handler.service";
import * as i5 from "./callback-handling/state-validation-callback-handler.service";
import * as i6 from "./callback-handling/refresh-session-callback-handler.service";
import * as i7 from "./callback-handling/refresh-token-callback-handler.service";
class FlowsService {
    constructor(codeFlowCallbackHandlerService, implicitFlowCallbackHandlerService, historyJwtKeysCallbackHandlerService, userHandlerService, stateValidationCallbackHandlerService, refreshSessionCallbackHandlerService, refreshTokenCallbackHandlerService) {
        this.codeFlowCallbackHandlerService = codeFlowCallbackHandlerService;
        this.implicitFlowCallbackHandlerService = implicitFlowCallbackHandlerService;
        this.historyJwtKeysCallbackHandlerService = historyJwtKeysCallbackHandlerService;
        this.userHandlerService = userHandlerService;
        this.stateValidationCallbackHandlerService = stateValidationCallbackHandlerService;
        this.refreshSessionCallbackHandlerService = refreshSessionCallbackHandlerService;
        this.refreshTokenCallbackHandlerService = refreshTokenCallbackHandlerService;
    }
    processCodeFlowCallback(urlToCheck, config, allConfigs) {
        return this.codeFlowCallbackHandlerService
            .codeFlowCallback(urlToCheck, config)
            .pipe(concatMap((callbackContext) => this.codeFlowCallbackHandlerService.codeFlowCodeRequest(callbackContext, config)), concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processSilentRenewCodeFlowCallback(firstContext, config, allConfigs) {
        return this.codeFlowCallbackHandlerService
            .codeFlowCodeRequest(firstContext, config)
            .pipe(concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processImplicitFlowCallback(config, allConfigs, hash) {
        return this.implicitFlowCallbackHandlerService
            .implicitFlowCallback(config, allConfigs, hash)
            .pipe(concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processRefreshToken(config, allConfigs, customParamsRefresh) {
        return this.refreshSessionCallbackHandlerService
            .refreshSessionWithRefreshTokens(config)
            .pipe(concatMap((callbackContext) => this.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(callbackContext, config, customParamsRefresh)), concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, deps: [{ token: i1.CodeFlowCallbackHandlerService }, { token: i2.ImplicitFlowCallbackHandlerService }, { token: i3.HistoryJwtKeysCallbackHandlerService }, { token: i4.UserCallbackHandlerService }, { token: i5.StateValidationCallbackHandlerService }, { token: i6.RefreshSessionCallbackHandlerService }, { token: i7.RefreshTokenCallbackHandlerService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, providedIn: 'root' }); }
}
export { FlowsService };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: function () { return [{ type: i1.CodeFlowCallbackHandlerService }, { type: i2.ImplicitFlowCallbackHandlerService }, { type: i3.HistoryJwtKeysCallbackHandlerService }, { type: i4.UserCallbackHandlerService }, { type: i5.StateValidationCallbackHandlerService }, { type: i6.RefreshSessionCallbackHandlerService }, { type: i7.RefreshTokenCallbackHandlerService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxvd3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItYXV0aC1vaWRjLWNsaWVudC9zcmMvbGliL2Zsb3dzL2Zsb3dzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQVczQyxNQUNhLFlBQVk7SUFDdkIsWUFDbUIsOEJBQThELEVBQzlELGtDQUFzRSxFQUN0RSxvQ0FBMEUsRUFDMUUsa0JBQThDLEVBQzlDLHFDQUE0RSxFQUM1RSxvQ0FBMEUsRUFDMUUsa0NBQXNFO1FBTnRFLG1DQUE4QixHQUE5Qiw4QkFBOEIsQ0FBZ0M7UUFDOUQsdUNBQWtDLEdBQWxDLGtDQUFrQyxDQUFvQztRQUN0RSx5Q0FBb0MsR0FBcEMsb0NBQW9DLENBQXNDO1FBQzFFLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBNEI7UUFDOUMsMENBQXFDLEdBQXJDLHFDQUFxQyxDQUF1QztRQUM1RSx5Q0FBb0MsR0FBcEMsb0NBQW9DLENBQXNDO1FBQzFFLHVDQUFrQyxHQUFsQyxrQ0FBa0MsQ0FBb0M7SUFDdEYsQ0FBQztJQUVKLHVCQUF1QixDQUNyQixVQUFrQixFQUNsQixNQUEyQixFQUMzQixVQUFpQztRQUVqQyxPQUFPLElBQUksQ0FBQyw4QkFBOEI7YUFDdkMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQzthQUNwQyxJQUFJLENBQ0gsU0FBUyxDQUFDLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FDNUIsSUFBSSxDQUFDLDhCQUE4QixDQUFDLG1CQUFtQixDQUNyRCxlQUFlLEVBQ2YsTUFBTSxDQUNQLENBQ0YsRUFDRCxTQUFTLENBQUMsQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUM1QixJQUFJLENBQUMsb0NBQW9DLENBQUMs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QUNYLENBQ0YsQ0FDRixDQUFDO0lBQ04sQ0FBQzs4R0F0SlUsWUFBWTtrSEFBWixZQUFZLGNBREMsTUFBTTs7U0FDbkIsWUFBWTsyRkFBWixZQUFZO2tCQUR4QixVQUFVO21CQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNvbmNhdE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9wZW5JZENvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9jb25maWcvb3BlbmlkLWNvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IHsgQ2FsbGJhY2tDb250ZXh0IH0gZnJvbSAnLi9jYWxsYmFjay1jb250ZXh0JztcbmltcG9ydCB7IENvZGVGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZSB9IGZyb20gJy4vY2FsbGJhY2staGFuZGxpbmcvY29kZS1mbG93LWNhbGxiYWNrLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBIaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL2hpc3Rvcnktand0LWtleXMtY2FsbGJhY2staGFuZGxlci5zZXJ2aWNlJztcbmltcG9ydCB7IEltcGxpY2l0Rmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL2ltcGxpY2l0LWZsb3ctY2FsbGJhY2staGFuZGxlci5zZXJ2aWNlJztcbmltcG9ydCB7IFJlZnJlc2hTZXNzaW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZSB9IGZyb20gJy4vY2FsbGJhY2staGFuZGxpbmcvcmVmcmVzaC1zZXNzaW9uLWNhbGxiYWNrLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBSZWZyZXNoVG9rZW5DYWxsYmFja0hhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jYWxsYmFjay1oYW5kbGluZy9yZWZyZXNoLXRva2VuLWNhbGxiYWNrLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBTdGF0ZVZhbGlkYXRpb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jYWxsYmFjay1oYW5kbGluZy9zdGF0ZS12YWxpZGF0aW9uLWNhbGxiYWNrLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyQ2FsbGJhY2tIYW5kbGVyU2VydmljZSB9IGZyb20gJy4vY2FsbGJhY2staGFuZGxpbmcvdXNlci1jYWxsYmFjay1oYW5kbGVyLnNlcnZpY2UnO1xuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIEZsb3dzU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29kZUZsb3dDYWxsYmFja0hhbmRsZXJTZXJ2aWNlOiBDb2RlRmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSBpbXBsaWNpdEZsb3dDYWxsYmFja0hhbmRsZXJTZXJ2aWNlOiBJbXBsaWNpdEZsb3dDYWxsYmFja0hhbmRsZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgaGlzdG9yeUp3dEtleXNDYWxsYmFja0hhbmRsZXJTZXJ2aWNlOiBIaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZWFkb25seSB1c2VySGFuZGxlclNlcnZpY2U6IFVzZXJDYWxsYmFja0hhbmRsZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgc3RhdGVWYWxpZGF0aW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZTogU3RhdGVWYWxpZGF0aW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJlZnJlc2hTZXNzaW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZTogUmVmcmVzaFNlc3Npb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVmcmVzaFRva2VuQ2FsbGJhY2tIYW5kbGVyU2VydmljZTogUmVmcmVzaFRva2VuQ2FsbGJhY2tIYW5kbGVyU2VydmljZVxuICApIHt9XG5cbiAgcHJvY2Vzc0NvZGVGbG93Q2FsbGJhY2soXG4gICAgdXJsVG9DaGVjazogc3RyaW5nLFxuICAgIGNvbmZpZzogT3BlbklkQ29uZmlndXJhdGlvbixcbiAgICBhbGxDb25maWdzOiBPcGVuSWRDb25maWd1cmF0aW9uW11cbiAgKTogT2JzZXJ2YWJsZTxDYWxsYmFja0NvbnRleHQ+IHtcbiAgICByZXR1cm4gdGhpcy5jb2RlRmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2VcbiAgICAgIC5jb2RlRmxvd0NhbGxiYWNrKHVybFRvQ2hlY2ssIGNvbmZpZylcbiAgICAgIC5waXBlKFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLmNvZGVGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZS5jb2RlRmxvd0NvZGVSZXF1ZXN0KFxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxuICAgICAgICAgICAgY29uZmlnXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLmhpc3RvcnlKd3RLZXlzQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5jYWxsYmFja0hpc3RvcnlBbmRSZXNldEp3dEtleXMoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tTdGF0ZVZhbGlkYXRpb24oXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnVzZXJIYW5kbGVyU2VydmljZS5jYWxsYmFja1VzZXIoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApO1xuICB9XG5cbiAgcHJvY2Vzc1NpbGVudFJlbmV3Q29kZUZsb3dDYWxsYmFjayhcbiAgICBmaXJzdENvbnRleHQ6IENhbGxiYWNrQ29udGV4dCxcbiAgICBjb25maWc6IE9wZW5JZENvbmZpZ3VyYXRpb24sXG4gICAgYWxsQ29uZmlnczogT3BlbklkQ29uZmlndXJhdGlvbltdXG4gICk6IE9ic2VydmFibGU8Q2FsbGJhY2tDb250ZXh0PiB7XG4gICAgcmV0dXJuIHRoaXMuY29kZUZsb3dDYWxsYmFja0hhbmRsZXJTZXJ2aWNlXG4gICAgICAuY29kZUZsb3dDb2RlUmVxdWVzdChmaXJzdENvbnRleHQsIGNvbmZpZylcbiAgICAgIC5waXBlKFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLmhpc3RvcnlKd3RLZXlzQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5jYWxsYmFja0hpc3RvcnlBbmRSZXNldEp3dEtleXMoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tTdGF0ZVZhbGlkYXRpb24oXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnVzZXJIYW5kbGVyU2VydmljZS5jYWxsYmFja1VzZXIoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApO1xuICB9XG5cbiAgcHJvY2Vzc0ltcGxpY2l0Rmxvd0NhbGxiYWNrKFxuICAgIGNvbmZpZzogT3BlbklkQ29uZmlndXJhdGlvbixcbiAgICBhbGxDb25maWdzOiBPcGVuSWRDb25maWd1cmF0aW9uW10sXG4gICAgaGFzaD86IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPENhbGxiYWNrQ29udGV4dD4ge1xuICAgIHJldHVybiB0aGlzLmltcGxpY2l0Rmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2VcbiAgICAgIC5pbXBsaWNpdEZsb3dDYWxsYmFjayhjb25maWcsIGFsbENvbmZpZ3MsIGhhc2gpXG4gICAgICAucGlwZShcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XG4gICAgICAgICAgdGhpcy5oaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tIaXN0b3J5QW5kUmVzZXRKd3RLZXlzKFxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgYWxsQ29uZmlnc1xuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XG4gICAgICAgICAgdGhpcy5zdGF0ZVZhbGlkYXRpb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrU3RhdGVWYWxpZGF0aW9uKFxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgYWxsQ29uZmlnc1xuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XG4gICAgICAgICAgdGhpcy51c2VySGFuZGxlclNlcnZpY2UuY2FsbGJhY2tVc2VyKFxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgYWxsQ29uZmlnc1xuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKTtcbiAgfVxuXG4gIHByb2Nlc3NSZWZyZXNoVG9rZW4oXG4gICAgY29uZmlnOiBPcGVuSWRDb25maWd1cmF0aW9uLFxuICAgIGFsbENvbmZpZ3M6IE9wZW5JZENvbmZpZ3VyYXRpb25bXSxcbiAgICBjdXN0b21QYXJhbXNSZWZyZXNoPzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIH1cbiAgKTogT2JzZXJ2YWJsZTxDYWxsYmFja0NvbnRleHQ+IHtcbiAgICByZXR1cm4gdGhpcy5yZWZyZXNoU2Vzc2lvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2VcbiAgICAgIC5yZWZyZXNoU2Vzc2lvbldpdGhSZWZyZXNoVG9rZW5zKGNvbmZpZylcbiAgICAgIC5waXBlKFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UucmVmcmVzaFRva2Vuc1JlcXVlc3RUb2tlbnMoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBjdXN0b21QYXJhbXNSZWZyZXNoXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLmhpc3RvcnlKd3RLZXlzQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5jYWxsYmFja0hpc3RvcnlBbmRSZXNldEp3dEtleXMoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tTdGF0ZVZhbGlkYXRpb24oXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cbiAgICAgICAgICB0aGlzLnVzZXJIYW5kbGVyU2VydmljZS5jYWxsYmFja1VzZXIoXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICBhbGxDb25maWdzXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApO1xuICB9XG59XG4iXX0=